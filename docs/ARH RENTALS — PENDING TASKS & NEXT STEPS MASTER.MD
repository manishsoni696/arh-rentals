ğŸ” ARH RENTALS â€” UPDATED PENDING TASKS & NEXT STEPS MASTER (v7.1)

Last Updated: Jan 9, 2026
Based on: v7.0 (cleaned & consolidated)
Scope: Post Property (Owner) + Dashboard + Backend only
âŒ Listings UI / Pricing / Demo / Business wording untouched

ğŸ§± GLOBAL STATUS (NON-NEGOTIABLE)

âœ… Static Frontend (GitHub Pages) â€” ACTIVE
âœ… Backend = Cloudflare Workers (native only)
âœ… Core Auth / Pricing / Legal â€” ğŸ”’ LOCKED
âœ… Responsive (Desktop + Tablet + Mobile) â€” ğŸ”’ MANDATORY

ğŸŸ¡ POST PROPERTY (OWNER) â€” FRONTEND
STATUS: IN PROGRESS (ACTIVE)
âœ… CONFIRMED & VERIFIED â€” ğŸ”’ LOCKED
ğŸ” Access & Gating (STABLE)

âœ… PIN Code check working

âœ… PIN verify ke baad hi Property Details unlock

âœ… Phone number + OTP PIN ke baad hi maanga jata hai

âœ… PIN backend trigger:

Enter key press âœ…

â€œCheck PINâ€ button click âœ…

ğŸ“Œ NOTE (LOCKED)
Core auth logic bilkul sahi hai
ğŸ‘‰ âŒ Koi auth change allowed nahi

ğŸ“ POST PROPERTY MODULE â€” FILE STRUCTURE (LOCKED)
/post/index.html

Purpose: HTML skeleton + complete form markup

ğŸ”’ Rule: âŒ No big inline JS

/assets/post-property.js

Purpose (single source):

Form logic

Local draft

Amenities render

Photo validation

Submit handling

PIN/OTP UI layer only

ğŸ”’ Rule: âŒ Core auth touch nahi karega

Depends on: /assets/app.js

/assets/styles.css

Post page styles scoped only

ğŸ”’ Rule:

.post-page { ... } only

Pricing FINAL LOCK block last & untouched

ğŸ”’ LOCKED FLOW DECISIONS (FINAL)
ğŸ§¾ Plans Flow

âœ… PIN + OTP ke baad direct Property Details

âœ… Plans / Payment submit ke baad show honge

âŒ Plans pehle nahi dikhenge

ğŸ”’ CLOUD DRAFT â€” FINAL RULES

Save allowed only after: PIN âœ… + OTP âœ…

Draft identity = logged-in mobile number

Draft scope = 1 draft per mobile

Storage = Cloudflare D1

Retention = 3 days (auto delete)

Restore Flow

PIN â†’ OTP â†’ draft check

Draft found â†’ Restore / Discard

No draft â†’ normal form

ğŸ“Œ Logout par draft delete nahi hota
(only discard or auto-expiry)

ğŸ”’ PHOTOS â€” BACKEND STORAGE STRUCTURE

Storage: Cloudflare R2

Path:

photos/{listingId}/{uuid}.{ext}


UUID filenames mandatory

Original filenames reuse âŒ

ğŸ§¾ CHANGE LOG â€” AUTH & UX (LOCKED)
ğŸ” Auth / Session UX

Logged-in status â†’ GLOBAL HEADER

Masked phone shown

Header dropdown active immediately after login

Logout only via header

Dashboard logout â†’ instant redirect (guard enforced)

ğŸ” Post Property Logout Reset

PIN cleared

Phone cleared

OTP cleared

OTP step hidden

Form locked again

Local draft retained

ğŸ” OTP UX

Verify via button + Enter key

Resend timer resets on logout

Quick login-logout issue fixed

ğŸŸ¢ DASHBOARD â€” UI
STATUS: COMPLETED & ğŸ”’ LOCKED

Dashboard UI upgraded

Subtitle (LOCKED):

â€œAccess and manage rental listings linked to this mobile number.â€

Quick cards + empty state finalized

âŒ No UI change allowed unless explicitly unlocked

ğŸŸ¡ PENDING â€” FRONTEND MUST-FIX (BEFORE MERGE)

âš ï¸ These are the ONLY active frontend tasks

âŒ Remove inline JS from /post/index.html

âŒ Amenities list must reuse FINAL Listings Filters amenities

âŒ Add <body class="post-page">

âŒ City value hard-lock = â€œHisarâ€

âŒ Property Type:

Backend-safe enum values

User-friendly labels

ğŸŸ  NEXT PHASE â€” BACKEND (ACTIVE BUT NOT STARTED)
ğŸŸ  Phase-1: Photo Upload (NO Compression)

Goal: Real backend upload pipeline

/api/uploads/init â†’ R2 pre-signed upload

Direct upload to R2

/api/listings/create

Server-side re-validation (type/size/count)

Partial upload fail â†’ âŒ listing not created

âŒ Compression NOT allowed (LOCKED)

ğŸŸ  Phase-1B: Cloud Draft Backend (D1)

/api/drafts/save (upsert)

/api/drafts/latest

/api/drafts/delete

Auto cleanup after 3 days

ğŸ”’ Phase-2 (LATER â€” DO NOT IMPLEMENT NOW)

Photo compression (~500KB target)

Only after Phase-1 stable

ğŸŸ¡ PLANNED (AFTER FRONTEND FINALIZE)
Post Property Form Field Changes

Scope: Frontend only

Fields / labels / validations

ğŸ“Œ Pending exact field list from owner

âœ… FINAL CONFIRMATIONS â€” ğŸ”’ LOCKED

âŒ No business wording changes

âŒ No core auth changes

âŒ Listings / Filters / Demo untouched

âœ… Scoped CSS safe

âœ… Modular Post Property active

âœ… Dashboard UI locked

âœ… ARH Rentals â€” CHANGELOG (Recent Work)

Date Range: Jan 9â€“10, 2026 (current session)
Area: Post Property (Draft) + CSP + Auto-Logout (Testing)

âœ… FIXED / DONE
1) Post Property JS Crash Fix (Critical)

Issue: post-property.js:744 Uncaught SyntaxError: Unexpected token ')'

Impact: à¤ªà¥‚à¤°à¤¾ post-property.js execute à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¥à¤¾ â†’ Save Draft button à¤•à¥‡ handlers attach à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤°à¤¹à¥‡ à¤¥à¥‡ â†’ Network call fire à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤°à¤¹à¥€ à¤¥à¥€

Status: âœ… Fixed (as per your update: error moved ahead to CSP connect-src block)

2) Cloud Draft API Call Attempt Enabled (but CSP blocked)

Observation: Save Draft click à¤ªà¤° à¤…à¤¬ code fetch attempt à¤•à¤° à¤°à¤¹à¤¾ à¤¹à¥ˆ (console à¤®à¥‡à¤‚ â€œFailed to fetchâ€ etc.)

Meaning: Button click handler à¤…à¤¬ attach à¤¹à¥‹ à¤šà¥à¤•à¤¾ à¤¹à¥ˆ à¤”à¤° code execute à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¹à¥ˆ

Status: âœ… Progress confirmed

3) CSP Connect-src Violation Identified (Root cause of â€œFailed to fetchâ€)

Issue: Draft API call hit à¤¹à¥‹ à¤°à¤¹à¥€ à¤¥à¥€:

https://arh-dashboard.manishsoni696.workers.dev/api/drafts/save

But CSP allow à¤¥à¤¾:

'self' + https://arh-backend.manishsoni696.workers.dev

Result: Browser à¤¨à¥‡ request block à¤•à¤° à¤¦à¥€

Status: âœ… Identified + Fix action provided (domain replace)

4) Fix Action Given: Correct Backend Domain Enforcement

Change Required: Draft endpoints à¤•à¤¾ base URL:

âŒ arh-dashboard... â†’ âœ… arh-backend...

Expected Result: CSP block à¤¹à¤Ÿà¥‡à¤—à¤¾ à¤”à¤° Network à¤®à¥‡à¤‚ /api/drafts/save request à¤¦à¤¿à¤–à¥‡à¤—à¥€

Status: ğŸŸ¡ Applied? (you havenâ€™t confirmed after reload yet)

ğŸŸ  NEW (Auto-Logout) â€” Testing Implementation Discussion
5) Antigravity â€œBrowser open rehne doâ€ Popup/Message Appeared

Issue: Testing mode à¤®à¥‡à¤‚ popup/alert à¤œà¥ˆà¤¸à¤¾ message à¤¦à¤¿à¤– à¤°à¤¹à¤¾ à¤¹à¥ˆ (unprofessional)

Status: ğŸŸ¡ Needs removal (final UX rule)

6) Final Decision Locked: Auto Logout Approach = OPTION 2

âœ… Approved Approach:
Frontend lastActivityAt + Backend token expiry (Workers)

Browser à¤¬à¤‚à¤¦ à¤¹à¥‹à¤¨à¥‡ à¤ªà¤° JS à¤¨à¤¹à¥€à¤‚ à¤šà¤²à¤¤à¤¾ (normal)

Next open à¤ªà¤° time-diff check à¤•à¤°à¤•à¥‡ immediate logout

Backend à¤¹à¤° protected request à¤ªà¤° expiry enforce à¤•à¤°à¥‡à¤—à¤¾ (401 â†’ logout)

Status: âœ… Decision locked (Implementation to be done cleanly)

ğŸŸ¡ PENDING / NEXT CHECKS (Immediate)
A) Confirm Draft Save request now appears in Network

After domain replace:

Network â†’ Fetch/XHR â†’ Save Draft click â†’ /api/drafts/save should appear

Status code record à¤•à¤°à¤¨à¤¾ à¤¹à¥ˆ (200/400/401/500)

B) Remove any remaining inline JS (CSP script-src issue)

Earlier console à¤®à¥‡à¤‚ inline script CSP block à¤¦à¤¿à¤–à¤¾ à¤¥à¤¾ (post/:365)

Status: ğŸŸ¡ Not re-confirmed after latest changes
(à¤…à¤—à¤° à¤…à¤­à¥€ à¤­à¥€ à¤¹à¥ˆ, à¤¤à¥‹ post/index.html à¤¸à¥‡ inline <script> à¤¹à¤Ÿà¤¾à¤¨à¤¾ à¤ªà¤¡à¤¼à¥‡à¤—à¤¾)

C) Remove testing popup/alert related to auto-logout

Final UX rule: âŒ no popups/alerts/instructional modals

Status: ğŸŸ¡ Pending

ğŸ“Œ IMPORTANT NOTE (Honesty)

à¤®à¥ˆà¤‚à¤¨à¥‡ changelog à¤®à¥‡à¤‚ à¤µà¤¹à¥€ à¤²à¤¿à¤–à¤¾ à¤¹à¥ˆ à¤œà¥‹:

à¤†à¤ªà¤•à¥‡ console/screenshots à¤®à¥‡à¤‚ à¤†à¤¯à¤¾

à¤¹à¤®à¤¾à¤°à¥€ chat à¤®à¥‡à¤‚ verify à¤¹à¥à¤†
à¤•à¥à¤› à¤šà¥€à¤œà¤¼à¥‡à¤‚ (à¤œà¥ˆà¤¸à¥‡ domain replace apply à¤¹à¥à¤† à¤¯à¤¾ inline JS à¤ªà¥‚à¤°à¥€ à¤¤à¤°à¤¹ à¤¹à¤Ÿ à¤—à¤¯à¤¾) à¤•à¥€ final confirmation à¤…à¤­à¥€ à¤†à¤ªà¤•à¥‡ next reload + network status à¤¸à¥‡ à¤¹à¥‹à¤—à¥€.
